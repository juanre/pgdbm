{"id":"pgdbm-4uv","title":"Code review remediation: correctness/security/docs","description":"Umbrella epic to track remediation items from the 2026-01 code review (performance, scalability, security, documentation accuracy).\\n\\nScope:\\n- Correctness \u0026 concurrency fixes\\n- Security hardening for identifier handling\\n- Docs/examples alignment with actual public API\\n- CLI reliability\\n- Repo hygiene\\n\\nDefinition of done:\\n- All child beads closed\\n- Docs/examples pass basic copy/paste sanity\\n- No known P0/P1 issues left open","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-05T11:42:47.701742Z","created_by":"juanre","updated_at":"2026-01-05T11:42:47.701742Z","labels":["code-review","epic"]}
{"id":"pgdbm-4uv.1","title":"Fix migration advisory lock to cover apply phase","description":"Problem\\n- AsyncMigrationManager.apply_pending_migrations() uses a session-level advisory lock but releases it before applying migrations.\\n\\nEvidence\\n- Lock/unlock occurs inside the initial async with self.db.acquire() as conn: block, but the apply loop runs after the block ends and the connection is returned to the pool (src/pgdbm/migrations.py:407).\\n\\nImpact\\n- Concurrent deploys/services can both see the same pending migrations and both apply them, leading to duplicate DDL/DML attempts, partial state, or confusing failures.\\n\\nSuggested fix\\n- Keep a single connection for: acquire lock -\u003e ensure migrations table -\u003e read applied -\u003e compute pending -\u003e apply each migration + insert tracking row -\u003e unlock -\u003e release.\\n- Prefer using the existing _apply_migration_on(conn, migration) path (or refactor apply_migration() to accept an optional connection) so all writes are on the same session holding the lock.\\n\\nAcceptance criteria\\n- Concurrent runs cannot interleave applies for the same module_name.\\n- A test demonstrates that a second runner blocks until the first releases the lock.\\n- Lock is held until all pending migrations are applied or an error occurs.","notes":"Held advisory lock for full apply phase and apply migrations on same connection; added concurrency test. Tests: uv run pytest tests/integration/test_migrations.py::TestMigrationManagement::test_migration_lock_serializes_apply","status":"closed","priority":0,"issue_type":"bug","assignee":"alice-coordinator","created_at":"2026-01-05T11:43:11.750245Z","created_by":"juanre","updated_at":"2026-01-05T16:55:01.877085Z","closed_at":"2026-01-05T16:55:01.877087Z","labels":["P0","concurrency","migrations"],"dependencies":[{"issue_id":"pgdbm-4uv.1","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:43:11.750909Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.10","title":"Fix docs: pgdbm[test] extra does not exist","notes":"Fixed docs/testing.md: removed non-existent pgdbm[test] extra; instruct to install pgdbm + pytest/pytest-asyncio (optional pgdbm[cli]). Validated with ruff/black/pytest.","status":"closed","priority":3,"issue_type":"bug","assignee":"bob-agent","created_at":"2026-01-05T11:44:17.084989Z","created_by":"juanre","updated_at":"2026-01-05T12:05:43.744235Z","closed_at":"2026-01-05T12:05:43.744235Z","close_reason":"Done: docs/testing install instructions corrected (no pgdbm[test]).","labels":["docs","packaging"],"dependencies":[{"issue_id":"pgdbm-4uv.10","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:17.085649Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.11","title":"Fix CLI run_async() behavior when an event loop is already running","notes":"Merged bob-4uv11 (commit 982814b); added run_async helper-thread path + tests. Ran uv run pytest tests/test_cli_utils.py tests/test_cli.py.","status":"closed","priority":1,"issue_type":"bug","assignee":"bob-agent","created_at":"2026-01-05T11:44:17.229307Z","created_by":"juanre","updated_at":"2026-01-05T18:13:16.713452Z","closed_at":"2026-01-05T18:13:16.713453Z","close_reason":"Done: run_async handles already-running event loop; regression tests added; 100 tests pass.","labels":["cli","correctness"],"dependencies":[{"issue_id":"pgdbm-4uv.11","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:17.230044Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.12","title":"Fix CLI migrate apply simple-mode bug (no config)","notes":"Resolve simple-mode apply/status by using DATABASE_URL fallback when no config; docs/cli.md updated to mention env var. Pre-commit ran; mypy skipped.","status":"closed","priority":1,"issue_type":"bug","assignee":"alice-coordinator","created_at":"2026-01-05T11:44:17.363739Z","created_by":"juanre","updated_at":"2026-01-05T18:02:28.569872Z","closed_at":"2026-01-05T18:02:28.569873Z","labels":["cli","migrations"],"dependencies":[{"issue_id":"pgdbm-4uv.12","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:17.364387Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.13","title":"Remove repo artifacts from src/ (editor backups, caches)","notes":"No tracked artifacts found under src/, but added ignore rules to prevent editor/cache artifacts (mypy/ruff caches, beadhub-cache, vim swap). Implemented on branch bob-4uv13-14 (commit d97e560), PR: https://github.com/juanre/pgdbm/pull/new/bob-4uv13-14. Validation: ruff/black/pytest pass.","status":"closed","priority":2,"issue_type":"chore","assignee":"bob-agent","created_at":"2026-01-05T11:44:17.491975Z","created_by":"juanre","updated_at":"2026-01-05T18:11:33.697632Z","closed_at":"2026-01-05T18:11:33.697632Z","close_reason":"Done: verified no tracked src artifacts; tightened .gitignore; PR bob-4uv13-14.","labels":["hygiene","packaging"],"dependencies":[{"issue_id":"pgdbm-4uv.13","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:17.492623Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.14","title":"Clean tracked coverage artifacts and other transient files","notes":"No tracked coverage/transient files found, but added ignore rules for common transient caches (mypy/ruff) and beadhub-cache + vim swap patterns to prevent future commits. Branch bob-4uv13-14 (commit d97e560), PR: https://github.com/juanre/pgdbm/pull/new/bob-4uv13-14. Validation: ruff/black/pytest pass.","status":"closed","priority":3,"issue_type":"chore","assignee":"bob-agent","created_at":"2026-01-05T11:44:17.62521Z","created_by":"juanre","updated_at":"2026-01-05T18:11:35.535425Z","closed_at":"2026-01-05T18:11:35.535425Z","close_reason":"Done: verified no tracked coverage/transient artifacts; tightened .gitignore; PR bob-4uv13-14.","labels":["hygiene"],"dependencies":[{"issue_id":"pgdbm-4uv.14","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:17.625937Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.15","title":"Review/adjust default pool sizing and document guidance","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T11:44:17.762177Z","created_by":"juanre","updated_at":"2026-01-05T11:44:17.762177Z","labels":["docs","performance"],"dependencies":[{"issue_id":"pgdbm-4uv.15","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:17.762759Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.16","title":"Clarify shared-pool search_path behavior vs documentation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T11:44:17.921572Z","created_by":"juanre","updated_at":"2026-01-05T11:44:17.921572Z","labels":["correctness","docs"],"dependencies":[{"issue_id":"pgdbm-4uv.16","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:17.922217Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.17","title":"Fix copy_records_to_table implementation clarity","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T11:44:18.064188Z","created_by":"juanre","updated_at":"2026-01-05T11:44:18.064188Z","labels":["core","correctness"],"dependencies":[{"issue_id":"pgdbm-4uv.17","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:18.064979Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.18","title":"Fix executemany docs example argument shape","notes":"Updated docs/quick-reference.md executemany example to use tuple rows + canonical fetch_value.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-05T12:23:46.88235Z","created_by":"juanre","updated_at":"2026-01-05T12:36:09.265189Z","closed_at":"2026-01-05T12:36:09.265191Z","labels":["docs"],"dependencies":[{"issue_id":"pgdbm-4uv.18","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T12:23:46.883077Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.2","title":"Validate schema identifiers at config-time (before SQL use)","notes":"Added schema identifier validation at config/manager init via _validate_schema_name; updated tests to expect early SchemaError. Tests: uv run pytest tests/test_security.py::TestSQLInjectionProtection::test_schema_name_validation_prevents_injection","status":"closed","priority":0,"issue_type":"bug","assignee":"alice-coordinator","created_at":"2026-01-05T11:44:16.008518Z","created_by":"juanre","updated_at":"2026-01-05T16:55:22.806937Z","closed_at":"2026-01-05T16:55:22.806939Z","labels":["P0","identifiers","security"],"dependencies":[{"issue_id":"pgdbm-4uv.2","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.009183Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.3","title":"Fix monitoring schema_filter SQL injection","notes":"Parameterize schema filter in analyze_table_sizes to avoid raw SQL interpolation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T11:44:16.147536Z","created_by":"juanre","updated_at":"2026-01-05T17:03:24.023288Z","closed_at":"2026-01-05T17:03:24.023289Z","labels":["monitoring","security"],"dependencies":[{"issue_id":"pgdbm-4uv.3","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.148325Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.4","title":"Reduce sensitive data retention in query monitoring","notes":"Added record_args flag with masked args; default is no arg recording. Documented in API reference.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T11:44:16.27868Z","created_by":"juanre","updated_at":"2026-01-05T17:03:28.362837Z","closed_at":"2026-01-05T17:03:28.362839Z","labels":["monitoring","security"],"dependencies":[{"issue_id":"pgdbm-4uv.4","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.279296Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.5","title":"Fix/replace broken prepared statement support","notes":"Removed invalid name parameter from asyncpg prepare; prepared statements no longer error during connection init.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T11:44:16.407059Z","created_by":"juanre","updated_at":"2026-01-05T17:03:34.398335Z","closed_at":"2026-01-05T17:03:34.398336Z","labels":["core","performance"],"dependencies":[{"issue_id":"pgdbm-4uv.5","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.407657Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.6","title":"Add fetch_val() compatibility alias (or update all docs/examples)","notes":"Implemented fetch_val compatibility alias (AsyncDatabaseManager + TransactionManager) and updated docs/examples to use canonical fetch_value. Updated docs API reference + core-api-reference skill; ruff/black/pytest pass.","status":"closed","priority":0,"issue_type":"task","assignee":"bob-agent","created_at":"2026-01-05T11:44:16.543974Z","created_by":"juanre","updated_at":"2026-01-05T12:04:41.437829Z","closed_at":"2026-01-05T12:04:41.437831Z","close_reason":"Done: fetch_val alias + docs/examples updated to fetch_value; API refs updated; tests pass.","labels":["P0","api","docs"],"dependencies":[{"issue_id":"pgdbm-4uv.6","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.544641Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.7","title":"Fix execute_many() docs drift (use executemany or add alias)","notes":"Docs now use executemany (quick-reference). Added execute_many() compatibility alias on AsyncDatabaseManager + TransactionManager. Validated with ruff/black/pytest.","status":"closed","priority":2,"issue_type":"task","assignee":"bob-agent","created_at":"2026-01-05T11:44:16.676502Z","created_by":"juanre","updated_at":"2026-01-05T12:05:21.053611Z","closed_at":"2026-01-05T12:05:21.053611Z","close_reason":"Done: docs updated to executemany; execute_many alias added; tests pass.","labels":["api","docs"],"dependencies":[{"issue_id":"pgdbm-4uv.7","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.677159Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.8","title":"Fix docs: AsyncDatabaseManager(config, schema=...) example is invalid","notes":"Fixed docs/migrations.md schema-context snippet: use DatabaseConfig(schema=...) with owned pool; kept pool=... schema override example for shared pool. Validated with ruff/black/pytest.","status":"closed","priority":2,"issue_type":"bug","assignee":"bob-agent","created_at":"2026-01-05T11:44:16.81427Z","created_by":"juanre","updated_at":"2026-01-05T12:05:28.70198Z","closed_at":"2026-01-05T12:05:28.70198Z","close_reason":"Done: docs/migrations schema example now matches AsyncDatabaseManager constructor rules.","labels":["docs"],"dependencies":[{"issue_id":"pgdbm-4uv.8","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.815099Z","created_by":"juanre"}]}
{"id":"pgdbm-4uv.9","title":"Fix docs: migration apply return shape is a dict, not an iterable","notes":"Updated docs/migrations.md apply_pending_migrations example: method returns dict; iterate result['applied'] list. Validated with ruff/black/pytest.","status":"closed","priority":2,"issue_type":"bug","assignee":"bob-agent","created_at":"2026-01-05T11:44:16.957838Z","created_by":"juanre","updated_at":"2026-01-05T12:05:36.997443Z","closed_at":"2026-01-05T12:05:36.997443Z","close_reason":"Done: docs/migrations apply_pending_migrations example now matches dict return shape.","labels":["docs","migrations"],"dependencies":[{"issue_id":"pgdbm-4uv.9","depends_on_id":"pgdbm-4uv","type":"parent-child","created_at":"2026-01-05T11:44:16.958518Z","created_by":"juanre"}]}
